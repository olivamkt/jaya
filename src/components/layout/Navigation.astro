---
import { withBase } from '@/utils/url'
import { socialLinks } from '@/data/social-links'
import { getTranslations, t } from '@/i18n/translations'
import { getLocale, getLocalizedPath } from '@/i18n/utils'

export interface Props {
	type: 'mobile' | 'desktop'
}

const { type } = Astro.props

// Active link detection
const currentPath = Astro.url.pathname
const isActive = (href: string) => {
	const siteUrl = Astro.site?.toString() || ''
	const path = href.replace(siteUrl, '')
	const active = path === '' ? currentPath === '/' : currentPath.startsWith(path)
	return active ? 'font-bold' : ''
}

// Navigation items
const locale = getLocale(Astro)
const translations = await getTranslations(locale)

const navigationItems = [
	{
		label: t(translations, 'nav.services'),
		type: 'dropdown',
		children: [
			{ label: t(translations, 'nav.fintech'), href: withBase(getLocalizedPath('fintech', locale)) },
			{ label: t(translations, 'nav.healthtech'), href: withBase(getLocalizedPath('healthtech', locale)) },
			{ label: t(translations, 'nav.retail'), href: withBase(getLocalizedPath('retail', locale)) },
			{ label: t(translations, 'nav.saas'), href: withBase(getLocalizedPath('saas', locale)) }
		]
	},
	{
		label: t(translations, 'nav.blog'),
		href: socialLinks.medium,
		target: '_blank'
	},
	{
		label: t(translations, 'nav.culture'),
		href: socialLinks.linkedin,
		target: '_blank'
	},
	{
		label: t(translations, 'nav.contact'),
		href: withBase(getLocalizedPath('contact', locale))
	}
]
---

{
	type === 'mobile' ? (
		// <!-- Mobile Navigation -->
		<ul class="menu menu-sm dropdown-content bg-base-100 rounded-box z-1 mt-3 w-52 p-2 shadow">
			{navigationItems.map((item) => (
				<li>
					{item.type === 'dropdown' ? (
						<>
							<a>{item.label}</a>
							<ul class="p-2">
								{item.children?.map((child) => (
									<li>
										<a href={child.href} class={isActive(child.href)}>
											{child.label}
										</a>
									</li>
								))}
							</ul>
						</>
					) : (
						<a href={item.href} class={isActive(item.href || '')} target={item.target}>
							{item.label}
						</a>
					)}
				</li>
			))}
		</ul>
	) : (
		// <!-- Desktop Navigation -->
		<ul class="menu menu-horizontal px-1">
			{navigationItems.map((item) => (
				<li>
					{item.type === 'dropdown' ? (
						<details>
							<summary>{item.label}</summary>
							<ul class="p-2">
								{item.children?.map((child) => (
									<li>
										<a href={child.href} class={isActive(child.href)}>
											{child.label}
										</a>
									</li>
								))}
							</ul>
						</details>
					) : (
						<a href={item.href} class={isActive(item.href || '')} target={item.target}>
							{item.label}
						</a>
					)}
				</li>
			))}
		</ul>
	)
}
